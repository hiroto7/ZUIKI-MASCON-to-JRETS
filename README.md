# ZUIKI-MASCON-to-JRETS

JR東日本トレインシミュレータ (JRETS) をズイキマスコンで操作できるようにするための非公式MODです。

JRETSは2024年5月からズイキマスコンを公式にサポートするようになりましたが、その後サービスが開始されたGeForce NOW版では非対応となっています。この非公式MODでは、ズイキマスコンからの入力をキーボード入力にマッピングすることで、擬似的にGeForce NOW版でもズイキマスコンで操作できるようにします。

なおGeForce NOW版でない通常版についても、ズイキマスコンの公式サポートが何らかの理由で動作しなくなった場合に、このMODを利用することで操作できるようになる可能性があります。

1ハンドル車と2ハンドル車の両方で使用でき、ボタンの長押しにも対応しています。

## 動作環境

macOS上のGeForce NOWで動作するように開発しています。以下の環境での動作を確認しています。

- Mac mini (2024)
- macOS Tahoe 26.0
- Python 3.13.5
- ズイキマスコン ZKNS-013
- JR東日本トレインシミュレータ Ver. 1.0.1.689
- GeForce NOW 2.0.77.157

Windows / Linuxでは動作を確認していません。

## 使い方

### macOSでアプリケーションをダウンロードして開く場合

1. [最新のRelease](https://github.com/hiroto7/ZUIKI-MASCON-to-JRETS/releases/latest)で ZUIKI-MASCON-to-JRETS.app.zip をダウンロードする
2. ダウンロードしたファイルを展開し、 ZUIKI-MASCON-to-JRETS.app を起動する
   - 「Appleは、“ZUIKI-MASCON-to-JRETS”にMacに損害を与えたり、プライバシーを侵害する可能性のあるマルウェアが含まれていないことを検証できませんでした」と警告され起動できない場合、 https://support.apple.com/ja-jp/guide/mac-help/mh40616/mac の手順に従って開く
3. Dockに ZUIKI-MASCON-to-JRETS のアイコンが表示されたら、JRETSの運転画面に進む
4. 一度マスコンをNまたはEBに合わせる
   - 「アクセシビリティ機能を使用してこのコンピュータを制御することを求めています」と表示された場合は、アクセスを許可する
5. 運転を開始する
6. 終了方法：Dockの ZUIKI-MASCON-to-JRETS のアイコンを右クリックして「終了」を選択する

### コマンドラインから実行する場合

1. リポジトリをクローンしてパッケージをインストールする
   ```
   git clone https://github.com/hiroto7/ZUIKI-MASCON-to-JRETS.git
   cd ZUIKI-MASCON-to-JRETS
   pip3 install pygame pyautogui
   ```
2. main.py を実行する
   ```
   python3 main.py
   ```
3. この状態でJRETSの運転画面に進み、一度マスコンをNまたはEBに合わせる
   - Macで「アクセシビリティ機能を使用してこのコンピュータを制御することを求めています」と表示された場合は、アクセスを許可する
4. 運転を開始する
5. 終了方法：ターミナルに戻り、 <kbd>control</kbd> + <kbd>c</kbd> を押す

## ボタンのマッピング

デフォルトのマッピングは、通常版（ダウンロード版）のズイキマスコンを使用したときと同じ挙動となるよう設定されています。例えば、公式サポートで「警笛（2段目）」に対応するAボタンは、キーボード操作で同じ意味となる <kbd>enter</kbd> キーにマッピングされます。同様に、「連絡ブザースイッチ」に対応する左ボタンは、 <kbd>b</kbd> キーにマッピングされます。なおHOMEボタンとキャプチャーボタンに限っては、GeForce Nowアプリのキーボードショートカットにマッピングされています。

デフォルトのマッピングの場合、公式サポートと同じ挙動となるのは運転画面のみです。メニュー画面では左右移動などの操作ができないため、キーボードやマウスを使用する必要があります。

このマッピングは main.py 内の `MAPPING_TO_KEYBOARD` を編集することでカスタマイズできます。ただしZLボタンにはマッピングを設定できません。
